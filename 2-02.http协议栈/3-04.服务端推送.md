## 服务端推送

提升单个对象性能的最佳方式，就是在它被用到之前就放到浏览器的缓存里面。这正是`HTTP/2` 的服务端推送的目的。推送使服务器能够主动将对象发给客户端，这可能是因为它知道客户端不久将用到该对象。如果允许服务器随意地将对象发送给客户端，可能会产生包括性能和安全在内的一系列问题，因此它不仅仅是一个如何做的问题，还是一个如何做才对的问题。

#### 推送对象

如果服务器决定要推送一个对象（`RFC` 中称为“推送响应”），会构造一个 `PUSH`_`PROMISE` 帧。这个帧有很多重要属性，列举如下。

• PUSH_PROMISE 帧首部中的流 ID 用来响应相关联的请求。推送的响应一定会对应到客户端已发送的某个请求。如果浏览器请求一个主体 HTML 页面，如果要推送此页面使用的某个 JavaScript 对象，服务器将使用请求对应的流 ID 构造 PUSH_PROMISE 帧。

• PUSH_PROMISE 帧的首部块与客户端请求推送对象时发送的首部块是相似的。所以客户端有办法放心检查将要发送的请求。

• 被发送的对象必须确保是可缓存的。

• :method 首部的值必须确保安全。安全的方法就是幂等的那些方法，这是一种不改变任何状态的好办法。例如，GET 请求被认为是幂等的，因为它通常只是获取对象，而POST 请求被认为是非幂等的，因为它可能会改变服务器端的状态。

• 理想情况下，PUSH_PROMISE 帧应该更早发送，应当早于客户端接收到可能承载着推送对象的 DATA 帧。假设服务器要在发送 PUSH_PROMISE 之前发送完整的 HTML，那客户端可能在接收到 PUSH_PROMISE 之前已经发出了对这个资源的请求。h2 足够健壮，可以优雅地解决这类问题，但还是会有些浪费。

• PUSH_PROMISE 帧会指示将要发送的响应所使用的流 ID。

